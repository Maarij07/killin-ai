"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9357],{1559:(e,t,a)=>{a.d(t,{ToastProvider:()=>l,d:()=>c});var o=a(95155),r=a(12115),i=a(24775),n=a(27515);let s=(0,r.createContext)(void 0);function l(e){let{children:t}=e,[a,l]=(0,r.useState)([]),c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,o=Math.random().toString(36).substring(7),r={id:o,message:e,type:t,duration:a};l(e=>[...e,r]),setTimeout(()=>{l(e=>e.filter(e=>e.id!==o))},a)},d=e=>{l(t=>t.filter(t=>t.id!==e))};return(0,o.jsxs)(s.Provider,{value:{showToast:c,showSuccess:e=>c(e,"success"),showError:e=>c(e,"error",6e3),showWarning:e=>c(e,"warning"),showInfo:e=>c(e,"info")},children:[t,a.map((e,t)=>(0,o.jsx)(i.A,{open:!0,autoHideDuration:e.duration,onClose:()=>d(e.id),anchorOrigin:{vertical:"top",horizontal:"right"},style:{top:"".concat(20+70*t,"px")},children:(0,o.jsx)(n.A,{onClose:()=>d(e.id),severity:e.type,variant:"filled",sx:{width:"100%",fontSize:"14px",fontWeight:"medium"},children:e.message})},e.id))]})}function c(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}},14585:(e,t,a)=>{a.d(t,{j2:()=>s});var o=a(52078),r=a(64663),i=a(12553);let n=(0,o.Wp)({apiKey:"AIzaSyBhaPnfVZavlfHQ4UEbORmirHOhRHJvw4I",authDomain:"kallinai.firebaseapp.com",projectId:"kallinai",storageBucket:"kallinai.firebasestorage.app",messagingSenderId:"293968338314",appId:"1:293968338314:web:fe15f7265de96c6ef7bc73",measurementId:"G-1LDHKR8B7F"}),s=(0,i.xI)(n);(0,r.P5)(n)},29141:(e,t,a)=>{a.d(t,{J:()=>g,UserProvider:()=>u});var o=a(95155),r=a(12115),i=a(14585),n=a(12553),s=a(19708),l=a(41444);let c=(0,r.createContext)(void 0),d="https://3758a6b3509d.ngrok-free.app/api";function u(e){let{children:t}=e,[a,u]=(0,r.useState)(null),[g,m]=(0,r.useState)(!0),[h,y]=(0,r.useState)(!1);(0,r.useEffect)(()=>{console.log("=== UserProvider initializing ===");let e=localStorage.getItem("auth_token"),t=localStorage.getItem("user_data");if(console.log("Stored token:",e?"exists":"none"),console.log("Stored user:",t?"exists":"none"),e&&t)try{let a=JSON.parse(t);console.log("✅ Restoring user session:",a.email);let o={id:a.id.toString(),email:a.email,name:a.name,role:a.role||"user",authType:"api"};u(o),m(!1),y(!0),console.log("✅ User session restored successfully"),w(e)}catch(e){console.error("❌ Error parsing stored user data:",e),localStorage.removeItem("user_data"),localStorage.removeItem("auth_token"),m(!1)}else console.log("No stored session, checking authentication..."),f()},[]);let f=()=>{if(console.log("Initializing fresh authentication check..."),!h){let e=localStorage.getItem("auth_token");e?(console.log("Found token without user data, validating..."),fetch("".concat(d,"/auth/me"),{headers:{Authorization:"Bearer ".concat(e),"ngrok-skip-browser-warning":"true"}}).then(e=>{if(e.ok)return e.json();throw Error("Token invalid")}).then(e=>{var t;console.log("✅ Token valid, setting user:",e.email);let a={id:e.id.toString(),email:e.email,name:e.name||(null==(t=e.email)?void 0:t.split("@")[0])||"User",role:e.role||"user",authType:"api"};u(a),localStorage.setItem("user_data",JSON.stringify(a)),m(!1)}).catch(e=>{console.log("❌ Token invalid or expired:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),v()})):(console.log("No authentication token found, checking Firebase..."),v())}},v=()=>(console.log("Setting up Firebase auth listener..."),(0,n.hg)(i.j2,async e=>{if(e){var t,a;console.log("Firebase user found:",e.email);try{let a=(0,s.aU)(),o=(0,s.rJ)(a,"admins"),r=(0,s.P)(o,(0,s._M)("email","==",(e.email||"").toLowerCase())),c=await (0,s.GG)(r);if(!c.empty){let t=c.docs[0].data();if(!0===t.disabled){await (0,n.CI)(i.j2),await l.vF.logSystemAction("DISABLED_ADMIN_AUTO_SIGNOUT","Disabled admin was automatically signed out: ".concat(e.email),"HIGH"),u(null),m(!1);return}}let d={id:e.uid,email:e.email||"",name:e.displayName||(null==(t=e.email)?void 0:t.split("@")[0])||"Admin",role:"admin",authType:"firebase"};console.log("Setting Firebase admin user:",d),u(d),m(!1)}catch(t){console.error("Error checking admin status:",t),u({id:e.uid,email:e.email||"",name:e.displayName||(null==(a=e.email)?void 0:a.split("@")[0])||"Admin",role:"admin",authType:"firebase"}),m(!1)}}else console.log("No Firebase user found"),u(null),m(!1)})),w=async e=>{try{console.log("Validating token in background...");let a=await fetch("".concat(d,"/auth/me"),{headers:{Authorization:"Bearer ".concat(e),"ngrok-skip-browser-warning":"true"}});if(a.ok){var t;let e=await a.json();console.log("Token is valid, updating user data:",e);let o={id:e.id.toString(),email:e.email,name:e.name||(null==(t=e.email)?void 0:t.split("@")[0])||"User",role:e.role||"user",authType:"api"};u(o),localStorage.setItem("user_data",JSON.stringify(o))}else console.log("Token is invalid, clearing session"),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),u(null)}catch(e){console.error("Background token validation failed:",e)}},p=async(e,t)=>{console.log("UserContext - loginUser called with:",e);try{let o=await fetch("".concat(d,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},body:JSON.stringify({username:e,password:t})}),r=await o.json();if(console.log("UserContext - API response:",r),o.ok&&r.success&&r.data&&r.data.access_token){var a;localStorage.setItem("auth_token",r.data.access_token);let e={id:r.data.user.id,email:r.data.user.email,name:r.data.user.name||(null==(a=r.data.user.email)?void 0:a.split("@")[0])||r.data.user.username||"User",role:r.data.user.role||"user",authType:"api"};return console.log("UserContext - Setting user data:",e),u(e),localStorage.setItem("user_data",JSON.stringify(e)),{success:!0}}{let e="Unable to sign in. Please try again.";return r.message?e=r.message:401===o.status?e="Invalid username/email or password. Please check your credentials and try again.":404===o.status?e="No account found with this username/email.":o.status>=500&&(e="Server error. Please try again later."),{success:!1,error:e}}}catch(t){let e="Network error. Please check your connection and try again.";return t instanceof Error&&t.message.includes("fetch")&&(e="Unable to connect to the server. Please check your internet connection."),{success:!1,error:e}}},k=async(e,t)=>{try{await (0,n.x9)(i.j2,e,t);try{let t=(0,s.aU)(),a=(0,s.rJ)(t,"admins"),o=(0,s.P)(a,(0,s._M)("email","==",e.toLowerCase())),r=await (0,s.GG)(o);if(!r.empty){let t=r.docs[0].data();if(!0===t.disabled)return await (0,n.CI)(i.j2),await l.vF.logSystemAction("DISABLED_ADMIN_LOGIN_ATTEMPT","Disabled admin attempted to login: ".concat(e),"HIGH"),{success:!1,error:"Your account has been disabled. Please contact a system administrator for assistance."}}return{success:!0}}catch(t){return console.error("Error checking admin disabled status:",t),console.warn("Could not verify admin status, allowing login"),await l.vF.logSystemAction("ADMIN_STATUS_CHECK_FAILED","Could not verify admin status for login: ".concat(e,". Error: ").concat(t),"MEDIUM"),{success:!0}}}catch(t){let e="Unable to sign in. Please try again.";switch(t.code){case"auth/user-not-found":e="No account found with this email address. Please check your email or create an account.";break;case"auth/wrong-password":e="Incorrect password. Please check your password and try again.";break;case"auth/invalid-email":e="Please enter a valid email address.";break;case"auth/user-disabled":e="This account has been temporarily disabled. Please contact support.";break;case"auth/too-many-requests":e="Too many failed login attempts. Please wait a moment and try again.";break;case"auth/invalid-credential":e="Invalid email or password. Please check your credentials and try again.";break;case"auth/network-request-failed":e="Network error. Please check your internet connection and try again.";break;case"auth/weak-password":e="Password should be at least 6 characters long.";break;case"auth/email-already-in-use":e="An account with this email already exists.";break;default:e=t.message&&t.message.includes("Firebase")?"Authentication service temporarily unavailable. Please try again later.":"Something went wrong during sign in. Please try again."}return{success:!1,error:e}}},A=async()=>{try{if((null==a?void 0:a.authType)==="firebase")await (0,n.CI)(i.j2);else{let e=localStorage.getItem("auth_token");e&&fetch("".concat(d,"/auth/logout"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"ngrok-skip-browser-warning":"true"}}).catch(()=>{}),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),u(null)}}catch(e){console.error("Logout error:",e)}};return(0,o.jsx)(c.Provider,{value:{user:a,isLoading:g,loginUser:p,loginAdmin:k,logout:A},children:t})}function g(){let e=(0,r.useContext)(c);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},41444:(e,t,a)=>{a.d(t,{Zx:()=>s,vF:()=>n,vN:()=>l});var o=a(19708),r=a(14585);class i{async logActivity(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"MEDIUM",n=arguments.length>4?arguments[4]:void 0;try{var s;let l=r.j2.currentUser;if(!l)return void console.warn("No authenticated user found for logging");let c={timestamp:new Date().toISOString(),adminId:l.uid,adminName:l.displayName||(null==(s=l.email)?void 0:s.split("@")[0])||"Unknown Admin",adminEmail:l.email||"unknown@example.com",action:e,category:t,details:a,severity:i,metadata:{...n,userAgent:window.navigator.userAgent,ipAddress:"Client-side"}};await (0,o.gS)(this.logsCollection,c),console.log("Activity logged:",e)}catch(e){console.error("Failed to log activity:",e)}}async getRecentLogs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;try{let t=(0,o.P)(this.logsCollection,(0,o.My)("timestamp","desc"),(0,o.AB)(e)),a=await (0,o.GG)(t),r=[];return a.forEach(e=>{r.push({id:e.id,...e.data()})}),r}catch(e){return console.error("Failed to fetch logs:",e),[]}}async getLogsByAdmin(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{let a=(0,o.P)(this.logsCollection,(0,o._M)("adminId","==",e),(0,o.My)("timestamp","desc"),(0,o.AB)(t)),r=await (0,o.GG)(a),i=[];return r.forEach(e=>{i.push({id:e.id,...e.data()})}),i}catch(e){return console.error("Failed to fetch admin logs:",e),[]}}async getLogsByCategory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{let a=(0,o.P)(this.logsCollection,(0,o._M)("category","==",e),(0,o.My)("timestamp","desc"),(0,o.AB)(t)),r=await (0,o.GG)(a),i=[];return r.forEach(e=>{i.push({id:e.id,...e.data()})}),i}catch(e){return console.error("Failed to fetch category logs:",e),[]}}async logPromptChanged(e,t,a){await this.logActivity("PROMPT_CHANGED","USER_MANAGEMENT","Admin changed prompt for ".concat(t," (").concat(e,")"),"MEDIUM",{targetEmail:e,targetUser:t,oldValue:a.oldPrompt,newValue:a.newPrompt})}async logMinutesAdded(e,t,a,o){await this.logActivity("MINUTES_ADDED","USER_MANAGEMENT","Admin added ".concat(a," minutes to ").concat(t," (").concat(e,"). New total: ").concat(o," minutes"),"MEDIUM",{targetEmail:e,targetUser:t,oldValue:o-a,newValue:o})}async logAdminCreated(e,t){await this.logActivity("ADMIN_CREATED","ADMIN_MANAGEMENT","New admin account created: ".concat(e," by ").concat(t),"HIGH",{targetEmail:e,createdBy:t})}async logAdminDeleted(e){await this.logActivity("ADMIN_DELETED","ADMIN_MANAGEMENT","Admin account deleted: ".concat(e),"CRITICAL",{targetEmail:e})}async logAdminUpdated(e,t){await this.logActivity("ADMIN_UPDATED","ADMIN_MANAGEMENT","Admin account updated: ".concat(e),"MEDIUM",{targetEmail:e,newValue:t})}async logUserAction(e,t,a){e.includes("LOGIN")||e.includes("LOGOUT")||await this.logActivity(e,"USER_MANAGEMENT",a,"MEDIUM",{targetEmail:t})}async logSystemAction(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LOW";e.includes("LOGIN")||e.includes("LOGOUT")||e.includes("ADMIN_SIGNIN")||await this.logActivity(e,"SYSTEM",t,a)}constructor(){this.db=(0,o.aU)(),this.logsCollection=(0,o.rJ)(this.db,"activity_logs")}}let n=new i;n.logActivity.bind(n);let s=n.getRecentLogs.bind(n);n.getLogsByAdmin.bind(n);let l=n.getLogsByCategory.bind(n)},42823:e=>{e.exports=JSON.parse('{"T":{"zB":"#FE5B02","ON":"#FFFFFF","XT":"#1a1a1a","Oh":{"50":"#f9fafb","Id":"#f3f4f6","zT":"#e5e7eb","Sh":"#d1d5db","jC":"#9ca3af","C2":"#6b7280","l8":"#4b5563","eD":"#374151","n4":"#1f2937","uu":"#111827"}}}')},55485:(e,t,a)=>{a.d(t,{D:()=>s,ThemeProvider:()=>n});var o=a(95155),r=a(12115);let i=(0,r.createContext)(void 0);function n(e){let{children:t}=e,[a,n]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=localStorage.getItem("kallin_theme");e?n("dark"===e):n(window.matchMedia("(prefers-color-scheme: dark)").matches)},[]),(0,r.useEffect)(()=>{a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("kallin_theme",a?"dark":"light")},[a]),(0,o.jsx)(i.Provider,{value:{isDark:a,toggleTheme:()=>{n(e=>!e)}},children:t})}function s(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}}}]);